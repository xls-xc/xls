<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>日志</title>
    <script src="../js/config.js"></script>
    <link rel="stylesheet" href="../css/config.css">

    <style>
        .demo-table-expand {
            font-size: 0;
        }
        .demo-table-expand label {
            width: 90px;
            color: #99a9bf;
        }
        .demo-table-expand .el-form-item {
            margin-right: 0;
            margin-bottom: 0;
            width: 50%;
        }
    </style>

</head>
<body>
<div id="app">

    <!--搜索和添加数据的按钮-->
    <el-button type="primary" icon="el-icon-circle-plus-outline" @click="addDeptDataDialog=true">添加用户信息</el-button>
    <el-input style="width:100px" placeholder="请输入搜索的部门名称" v-model="searchDname" clearable></el-input>
    <el-button type="primary" icon="el-icon-search" @click="reloadDataMethod">搜索</el-button>
    <!----------------------------------------------添加对话框------------------------------------------------------>
    <el-dialog title="添加部门" :visible.sync="addDeptDataDialog">
        <el-radio-group v-model="labelPosition" size="small">
            <el-radio-button label="left">左对齐</el-radio-button>
            <el-radio-button label="right">右对齐</el-radio-button>
            <el-radio-button label="top">顶部对齐</el-radio-button>
        </el-radio-group>
        <div style="margin: 20px;"></div>
        <el-form :label-position="labelPosition" label-width="80px" :model="formLabelAlign">
            <el-form-item label="部门名称" >
                <el-input v-model="formLabelAlign.dname"></el-input>
            </el-form-item>
            <el-form-item label="位置" >
                <el-input v-model="formLabelAlign.loc"></el-input>
            </el-form-item>
            <el-form-item label="创建时间">
                <el-date-picker v-model="formLabelAlign.createtime" type="datetime"placeholder="选择日期时间"></el-date-picker>
            </el-form-item>
        </el-form>

        <div slot="footer" class="dialog-footer">
            <el-button @click="addDeptDataDialog = false">取 消</el-button>
            <el-button type="primary" @click="addDeptDataMethod('formLabelAlign')">添加</el-button>
        </div>
    </el-dialog>

    <!---------------------------------------------------修改对话框----------------------------------------------------->
    <el-dialog title="修改部门" :visible.sync="updDeptDataDialog">
        <el-radio-group v-model="labelPosition" size="small">
            <el-radio-button label="left">左对齐</el-radio-button>
            <el-radio-button label="right">右对齐</el-radio-button>
            <el-radio-button label="top">顶部对齐</el-radio-button>
        </el-radio-group>
        <div style="margin: 20px;"></div>
        <el-form :label-position="labelPosition" label-width="80px" :model="formLabelAlign">
            <el-form-item label="部门名称" >
                <el-input v-model="formLabelAlign.dname"></el-input>
            </el-form-item>
            <el-form-item label="位置" >
                <el-input v-model="formLabelAlign.loc"></el-input>
            </el-form-item>
        </el-form>

        <div slot="footer" class="dialog-footer">
            <el-button @click="updDeptDataDialog = false">取 消</el-button>
            <el-button type="primary" @click="saveUpdDeptDataMetod('formLabelAlign')">保存</el-button>
        </div>
    </el-dialog>

    <!-----------------------------------------------展示数据的表格--------------------------------------------------->
    <el-table :data="deptList" :default-sort = "{prop: 'deptno', order: 'ascending'}" @sort-change="mySortMethod" style="width: 100%">
        <el-table-column label="部门编号" prop="deptno"  sortable="custom" ></el-table-column>
        <el-table-column label="部门名称" prop="dname"></el-table-column>
        <el-table-column label="位置" prop="loc"></el-table-column>
        <el-table-column label="创建时间" prop="createtime"></el-table-column>
        <el-table-column
                align="right">
            <template slot-scope="scope">
                <el-button
                        size="mini"
                        @click="updDeptDataMethod(scope.$index, scope.row)">修改</el-button>
                <el-button
                        size="mini"
                        type="danger"
                        @click="delDeptDataMethod(scope.row)">删除</el-button>
            </template>
        </el-table-column>
    </el-table>

    <!----------------------------------------------------------分页------------------------------------------------------>
    <div class="block">
        <el-pagination
                @size-change="handleSizeChange"
                @current-change="handleCurrentChange"
                :current-page="pageNo"
                :page-sizes="[3,6,9,12]"
                :page-size="pageSize"
                layout="total, sizes, prev, pager, next, jumper"
                :total="totalRow">
        </el-pagination>
    </div>
</div>

<script type="text/javascript">
    var vue =new Vue({
        el:"#app",
        data:{
            searchDname:'',
            deptList:[],
            addDeptDataDialog:false,
            updDeptDataDialog:false,
            formLabelAlign: {
                dname: '',
                loc: '',
                createtime:''

            },
            labelPosition:'right',
            pageNo:1,
            pageSize:3,
            totalRow:0,
            prop:'',
            order:''

        },
        created:function () {//查询所有数据
            //注意this如果在axios的请求之内，则不是指当前实例化对象  也可以使用开始使用的实例变量vue
            //var temp = this;

            var start=(this.pageNo-1)*this.pageSize;
            var end =this.pageSize;

            var params = new URLSearchParams();
            params.append("page", 1);
            params.append("rows",10);

            var queryMap = {"1":1};
            axios.post(fx_ipAddr+'/xcInteractionLog/dataGrid',queryMap)
                .then(function (response) {
                    vue.deptList=response.data.records;
                    vue.totalRow=response.data.total;
                });
        },
        methods:{
            reloadDataMethod:function(){//公共请求数据的方法，增删改都需要实时请求最新的数据给表格展示
                var start=(vue.pageNo-1)*vue.pageSize;
                var end =vue.pageSize;
                var query={
                    "start":start,
                    "end":end,
                    "prop":vue.prop,
                    "order":vue.order,
                    "searchDname":vue.searchDname
                }
                axios.post('/dept/dataGrid',query)
                    .then(function (response) {
                        vue.deptList=response.data.dataList;
                        vue.totalRow=response.data.totalRow;
                    });
            },
            addDeptDataMethod:function (formName) {//添加
                /**
                 * 方式一：处理json数据传到方便传到后台
                 * 方式二：在后台接收的参数定义@RequestBody 接收参数转为json
                 */
                var param = new URLSearchParams(vue.formLabelAlign);
                axios.post('/dept/addDept',param)
                    .then(function (response) {
                        //调用公共请求数据的方法
                        vue.reloadDataMethod();
                        //关闭窗口
                        vue.addDeptDataDialog=false;
                    });

            },
            delDeptDataMethod:function (row) {//删除
                var param = new URLSearchParams();
                param.append('deptno',row.deptno)
                axios({
                    method: 'post',
                    url: '/dept/delDeptData',
                    data: param
                }).then(function (response) {
                    vue.reloadDataMethod();
                });
            },
            updDeptDataMethod:function (index,row) {//弹出修改框
                vue.formLabelAlign={
                    deptno:row.deptno,
                    dname: row.dname,
                    loc: row.loc
                }
                vue.updDeptDataDialog=true;
            },
            saveUpdDeptDataMetod:function (formName) {//保存修改
                axios.post('/dept/saveDeptData',vue.formLabelAlign)
                    .then(function (response) {
                        vue.updDeptDataDialog=false;
                        vue.reloadDataMethod();
                    });
            },
            handleCurrentChange:function (pageNo) {//指定页码
                vue.pageNo=pageNo;
                vue.reloadDataMethod();
            },
            handleSizeChange:function (pageSize) {//指定每页显示几条数据
                vue.pageSize=pageSize;
                vue.reloadDataMethod();
            },
            mySortMethod:function(column, prop, order) {
                vue.prop=column.prop;
                vue.order=column.order;
                console.log(column.order);
                vue.reloadDataMethod();
            }
        }
    });
</script>
</body>
</html>